<!DOCTYPE html>
<html lang="en">

<head>
    <title>Calculateur d'IMC</title>
    <script src="index.js"></script>
    <!-- Ce script est chargé après index.js pour ne pas redéfinir `Module` -->
    <script>
        window.onload = function () {
            // C'est ici que la fonction `Module` est initialisée correctement
            var Module = {
                locateFile: function (path) {
                    if (path.endsWith('.wasm')) {
                        return './index.wasm';  // Indiquer où trouver le fichier .wasm
                    }
                    return path;
                },
                onRuntimeInitialized: () => {
                    const form = document.getElementById("imc-form");
                    const output = document.getElementById("output");
                    const patients = document.getElementById("patients");

                    form.addEventListener("submit", function (e) {
                        e.preventDefault();

                        const poids = parseFloat(document.getElementById("poids").value);
                        const taille = parseFloat(document.getElementById("taille").value);

                        // Appeler la fonction C pour calculer l'IMC
                        const resultat = Module.ccall(
                            'traiter_patient', // Nom de la fonction C
                            'string',          // Type de retour
                            ['number', 'number'], // Types des paramètres
                            [poids, taille]    // Valeurs des paramètres
                        );

                        // Afficher le résultat
                        output.innerText = resultat.replace(/\n/g, '<br>');

                        // Obtenir le nombre total de patients traités
                        const totalPatients = Module.ccall(
                            'obtenir_nombre_patients', // Nom de la fonction
                            'number',                  // Type de retour
                            [],                        // Pas de paramètres
                            []
                        );
                        patients.innerText = `Nombre total de patients traités : ${totalPatients}`;
                    });
                }
            };
        }
    </script>
</head>

<body>
    <h1>Calculateur d'IMC</h1>
    <form id="imc-form">
        <label for="poids">Poids (kg) :</label>
        <input type="number" id="poids" step="0.1" required><br><br>
        <label for="taille">Taille (m) :</label>
        <input type="number" id="taille" step="0.01" required><br><br>
        <button type="submit">Calculer</button>
    </form>

    <h2>Résultats</h2>
    <pre id="output"></pre>

    <p id="patients"></p>
</body>

</html>
